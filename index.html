<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iliya Portfolio</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="assets/logo/mylogo3.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <header class="main-header">
    <div class="header-center">
      <div class="logo-title" onclick="toggleAdminLogin()">
        <img src="assets/logo/mylogo3.png" loading="lazy" alt="Logo" class="logo-icon" />
        <h1 style="color: black;">Iliya Rad</h1>
      </div>
  <div class="language-switcher">
  <button class="language-btn" onclick="toggleLanguageMenu()">
    <i class="fas fa-globe"></i> <!-- 👈 آیکون کره زمین برگشت -->
  </button>
  <ul id="language-menu" class="language-menu">
    <li onclick="setLanguage('en')">
      <img src="https://flagcdn.com/w20/gb.png" alt="EN" class="flag-icon" /> EN
    </li>
    <li onclick="setLanguage('fa')">
      <img src="https://flagcdn.com/w20/ir.png" alt="FA" class="flag-icon" /> FA
    </li>
    <li onclick="setLanguage('ar')">
      <img src="https://flagcdn.com/w20/sa.png" alt="AR" class="flag-icon" /> AR
    </li>
  </ul>
</div>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
  <div class="sidebar-top">
    <div class="coin-wrapper">
      <div class="coin">
        <img src="assets/image/mypic.png" loading="lazy" alt="Logo" class="coin-face front" />
        <img src="assets/logo/mylogo3.png" loading="lazy" alt="Profile" class="coin-face back" />
      </div>
    </div>
    <button class="hamburger" onclick="toggleMenu()">☰</button>
  </div>

  <nav class="menu">
    <a href="#" onclick="showSection('about')" data-i18n="about">About Me</a>
    <a href="#" onclick="showSection('public-blog')" data-i18n="blog">Blog</a>
    <a href="#" onclick="showSection('portfolio')" data-i18n="portfolio">Portfolio</a>
    <a href="#" onclick="showSection('contact')" data-i18n="contact">Contact</a>
  </nav>
</aside>

    <main class="main-content">
     <section id="about" class="public-section hidden">
  <!-- ویدیو پس‌زمینه -->
  <video autoplay muted loop playsinline preload="none" class="about-bg-video">
    <source src="assets/backvid-about/coding.mp4" type="video/mp4">
    مرورگر شما از ویدیو پشتیبانی نمی‌کند.
  </video>
  <!-- محتوای متن -->
  <div class="about-content">
    <p id="about-fa">
      من ایلیا راد هستم، توسعه‌دهنده‌ی فرانت‌اند با علاقه‌مندی ویژه به ساخت رابط‌های کاربری روان، زیبا و سازگار با تمام دستگاه‌ها. تمرکزم روی طراحی چندزبانه و تجربه‌ی کاربری بی‌نقص است تا هر کاربر، صرف‌نظر از زبان یا دستگاه، تجربه‌ای یکسان و حرفه‌ای داشته باشد
    </p>
    <p id="about-en" class="hidden"></p>
    <p id="about-ar" class="hidden"></p>
  </div>
</section>
      <section id="blog" class="public-section hidden" data-i18n="blogContent"></section>
      <div id="public-blog" class="public-section hidden">
      <div id="public-blog-list" class="blog-list"></div>
      </div>
      <!-- <section id="portfolio" class="content-section" data-i18n="portfolioContent">Portfolio gallery will appear here.</section> -->
       <section id="portfolio" class="public-section portfolio-gallery hidden" data-i18n="portfolioContent">
  <div class="gallery-wrapper">
    <button class="nav-btn left" onclick="scrollGallery(-1)">&#8592;</button>
    <div class="gallery-track">
      <a href="assets/samples/sampel1/link/startbootstrap-creative-gh-pages/index.html" target="_blank"><img src="assets/samples/sampel1/img/Screenshot -ghoghnoos.png" alt="Site 1" /></a>
      <a href="https://example2.com" target="_blank"><img src="assets/samples/site2.png" alt="Site 2" /></a>
      <a href="https://example3.com" target="_blank"><img src="assets/samples/site3.png" alt="Site 3" /></a>
      
    </div>
    <button class="nav-btn right" onclick="scrollGallery(1)">&#8594;</button>
  </div>
</section>
      <section id="contact" class="public-section contact-layout hidden">
        <form class="contact-form" action="https://formsubmit.co/alirezamotieerad@gmail.com" method="POST">
        <input type="text" name="name" placeholder="Your Name" required />
        <input type="email" name="email" placeholder="Your Email" required />
        <textarea name="message" placeholder="Your Message" required></textarea>
        <button type="submit" data-i18n="send">Send</button>
         </form>
        <div class="contact-info">
          <div class="contact-info">
         <p data-i18n="phone"><a href="tel:+96879696086">+96879696086</a></p>
         <p data-i18n="email"><a href="mailto:alirezamotieerad@gmail.com">alirezamotieerad@gmail.com</a></p>
         </div>
          <div class="social-links">
            <a href="https://github.com/Iliya-Official" target="_blank"><i class="fab fa-github"></i></a>
            <a href="https://linkedin.com/in/iliya-rad-783b0b281" target="_blank"><i class="fab fa-linkedin"></i></a>
            <a href="https://wa.me/+96879696086" target="_blank"><i class="fab fa-whatsapp"></i></a>
          </div>
        </div>
      </section>

     <div id="admin-login" class="admin-login hidden">
  <h2>🔐 Admin Login</h2>
  <form id="admin-form">
    <input type="text" id="adminUser" placeholder="Username" autocomplete="off" />
    <input type="password" id="adminPass" placeholder="Password" autocomplete="new-password" />
    <button type="submit">🔐 Login</button>
  </form>
  <button id="admin-logout-btn" onclick="logoutAdmin()" class="hidden">🚪 Logout</button>
</div>

<section id="admin-panel" class="content-section hidden">
  <div class="admin-header">
    <div class="admin-tabs">
      <button onclick="showAdminTab('about-tab')">درباره من</button>
      <button onclick="showAdminTab('blog-tab')">بلاگ</button>
      <button onclick="showAdminTab('portfolio-tab')">نمونه‌کارها</button>
      <button onclick="showAdminTab('contact-tab')">ارتباط با من</button>
      <button onclick="showAdminTab('settings-tab')">تغییر رمز عبور</button>
    </div>
    <!-- <button id="admin-logout-btn" onclick="logoutAdmin()">🔌 خروج</button> -->
  </div>

  <div id="about-tab" class="admin-tab hidden">
  <h3>✏️ ویرایش متن درباره من</h3>
  <textarea id="about-fa-edit" placeholder="متن فارسی درباره من" rows="5"></textarea>
  <button onclick="saveAbout(document.getElementById('about-fa-edit').value)">💾 ذخیره</button>
</div>


  <div id="blog-tab" class="admin-tab hidden">
    <h2>📝 Add New Blog Post</h2>
    <input type="text" id="blog-title" placeholder="Blog Title" />
    <select id="blog-category">
      <option value="general">General</option>
      <option value="tech">Tech</option>
      <option value="design">Design</option>
    </select>
    <textarea id="blog-body-fa" placeholder="Blog Content"></textarea>
    <button onclick="addBlog()">Add Blog</button>
    <div class="blog-filter">
      <button onclick="filterBlogs('all')">All</button>
      <button onclick="filterBlogs('tech')">Tech</button>
      <button onclick="filterBlogs('design')">Design</button>
      <button onclick="filterBlogs('general')">General</button>
    </div>
    <div id="blog-list" class="blog-list"></div>
  </div>

  <div id="portfolio-tab" class="admin-tab hidden">
    <h2>🎨 Add Portfolio Item</h2>
    <input type="text" id="portfolio-title" placeholder="Project Title" />
    <input type="text" id="portfolio-link" placeholder="Local path (e.g. templates/shop/index.html)" />
    <input type="url" id="portfolio-image" placeholder="Image URL" />
    <button onclick="addPortfolio()">Add Portfolio</button>
    <div id="portfolio-list" class="portfolio-list"></div>
  </div>

  <div id="contact-tab" class="admin-tab hidden">
    <h3>📞 تنظیمات تماس</h3>
    <input type="text" id="admin-phone" placeholder="شماره تلفن" />
    <input type="email" id="admin-email" placeholder="ایمیل" />
    <input type="text" id="admin-social" placeholder="لینک شبکه اجتماعی" />
    <button onclick="saveContactInfo()">ثبت اطلاعات تماس</button>
  </div>

  <div id="settings-tab" class="admin-tab hidden">
    <h3>🔐 تغییر رمز عبور</h3>
    <input type="text" id="new-username" placeholder="نام کاربری جدید" />
    <input type="password" id="new-password" placeholder="رمز عبور جدید" />
    <button onclick="updateAdminCredentials()">ثبت تغییرات</button>
  </div>
</section>

 </div>
  <!-- ✅ فوتر داخل main-content -->
      <footer class="site-footer">
         <p>© 2025 Iliya Rad. All rights reserved.</p>
      </footer>

      
    </main>
    
  </div>
 

  <script>
 window.addEventListener('DOMContentLoaded', () => {
  document.querySelector(".menu").style.display = "";
  document.querySelector(".main-content").scrollTop = 0;
  
translateAboutSection().then(() => {
    showAboutByLang('en');
  });


  // بستن منوی زبان در شروع
  document.getElementById('language-menu')?.classList.remove('show');

  // تنظیم زبان ذخیره‌شده
  const lang = localStorage.getItem('selectedLanguage') || 'en';
  setLanguage(lang); 
  // loadBlogsFromStorage();

  // بارگذاری نمونه‌کارها
  loadPortfolio();
  loadPortfolioAdmin();

  // اتصال فرم لاگین
  const loginForm = document.getElementById('admin-form');
  if (loginForm) {
    loginForm.addEventListener('submit', function (e) {
      e.preventDefault();
      loginAdmin();
      showSection('admin-panel');
    });

  window.addEventListener('load', () => {
  loadBlogsFromStorage();
  loadPublicBlogs(true);
  });
  }

  // نمایش بخش اولیه
  showSection('about');
  //فرم تغییر شماره تماس و ایمیل پنل ادمین
  const savedContact = localStorage.getItem('contactInfo');
if (savedContact) {
  const { phone, email, social } = JSON.parse(savedContact);
  document.getElementById('admin-phone').value = phone || '';
  document.getElementById('admin-email').value = email || '';
  document.getElementById('admin-social').value = social || '';
}

});

window.addEventListener("orientationchange", () => {
  const menu = document.querySelector(".menu");
  const main = document.querySelector(".main-content");
  if (menu) {
    menu.style.display = "";
    menu.classList.remove("open");
  }
  if (main) {
    main.scrollTop = 0;
  }
});

    const translations = {
  en: {
    about: "About Me",
    blog: "Blog",
    portfolio: "Portfolio",
    contact: "Contact",
    send: "Send",
    phone: 'Phone: <a href="tel:+96879696086">+96879696086</a>',
    email: 'Email: <a href="mailto:alirezamotieerad@gmail.com">alirezamotieerad@gmail.com</a>'

  },
  fa: {
    about: "درباره من",
    blog: "بلاگ",
    portfolio: "نمونه‌کارها",
    contact: "ارتباط با من",
    send: "ارسال",
    phone: 'تلفن: <a href="tel:+96879696086">+96879696086</a>',
    email: 'ایمیل: <a href="mailto:alirezamotieerad@gmail.com">alirezamotieerad@gmail.com</a>'

  },
  ar: {
    about: "من أنا",
    blog: "المدونة",
    portfolio: "الأعمال",
    contact: "اتصل بي",
    send: "إرسال",
    phone: 'الهاتف: <a href="tel:+96879696086">+96879696086</a>',
    email: 'البريد الإلكتروني: <a href="mailto:alirezamotieerad@gmail.com">alirezamotieerad@gmail.com</a>'
  }
};

function applyTranslations(lang) {
  const htmlKeys = ['phone', 'email']; 

  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    const value = translations[lang]?.[key];

    if (value) {
      if (htmlKeys.includes(key)) {
        el.innerHTML = value;
      } else {
        el.textContent = value;
      }
    }
  });
}
    function toggleAdminLogin() {
  const loginBox = document.getElementById('admin-login');
  if (loginBox) {
    loginBox.classList.toggle('hidden');
  }
}
  let adminUsername = 'admin';
  let adminPassword = 'admin777';

function loginAdmin() {
  const username = document.getElementById('adminUser').value.trim();
  const password = document.getElementById('adminPass').value.trim();

  const savedUser = localStorage.getItem('adminUser') || 'admin';
  const savedPass = localStorage.getItem('adminPass') || 'admin777';

  if (username === savedUser && password === savedPass) {
    alert('✅ خوش آمدید!');

    // پنهان کردن فرم لاگین
    const loginBox = document.getElementById('admin-login');
    if (loginBox) loginBox.classList.add('hidden');

        // نمایش کامل پنل ادمین
    const adminPanel = document.getElementById('admin-panel');
    if (adminPanel) {
      adminPanel.classList.remove('hidden');
      adminPanel.style.display = 'block'; // ✅ نمایش اجباری چون .content-section خودش display:none دارد
    }

        // نمایش دکمه خروج (هر کدام که وجود دارد)
    const logoutBtns = document.querySelectorAll('#admin-logout-btn');
    logoutBtns.forEach(btn => btn.classList.remove('hidden'));
    
   // document.getElementById('admin-login').classList.add('hidden');
    // document.getElementById('admin-panel').classList.remove('hidden');
    // document.getElementById('admin-logout-btn').classList.remove('hidden');

    // فعال کردن تب پیش‌فرض
    showAdminTab('about-tab');

    // بارگذاری داده‌ها
  //  loadBlogAdmin?.();
  //  loadPortfolioAdmin?.();
  } else {
    alert('❌ اطلاعات ورود اشتباه است.');
  }
}

// function logoutAdmin() {
//   document.getElementById('admin-login').classList.remove('hidden');
//   document.getElementById('admin-panel').classList.add('hidden');
//   document.getElementById('admin-logout-btn').classList.add('hidden');
//   document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
//   showSection('about');
// }

function logoutAdmin() {
  const loginBox = document.getElementById('admin-login');
  const adminPanel = document.getElementById('admin-panel');
  const logoutBtns = document.querySelectorAll('#admin-logout-btn');

  if (loginBox) loginBox.classList.remove('hidden');
  if (adminPanel) {
    adminPanel.classList.add('hidden');
    adminPanel.style.display = 'none';
  }
  logoutBtns.forEach(btn => btn.classList.add('hidden'));

  document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
  showSection('about');
}

function updateAdminCredentials() {
  const newUser = document.getElementById('new-username').value.trim();
  const newPass = document.getElementById('new-password').value.trim();
  if (!newUser || !newPass) return alert('Please fill in both fields.');
  adminUsername = newUser;
  adminPassword = newPass;
  alert('✅ Admin credentials updated!');
  document.getElementById('new-username').value = '';
  document.getElementById('new-password').value = '';
}

function showAdminTab(id) {
  document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  const target = document.getElementById(id);
  if (target) {
    target.classList.add('active');
  }
}

function saveContactInfo() {
  const phone = document.getElementById('admin-phone').value.trim();
  const email = document.getElementById('admin-email').value.trim();
  const social = document.getElementById('admin-social').value.trim();

  if (!phone || !email) {
    alert('❌ لطفاً شماره و ایمیل را وارد کنید.');
    return;
  }

  const contactInfo = { phone, email, social };
  localStorage.setItem('contactInfo', JSON.stringify(contactInfo));
  alert('✅ اطلاعات تماس با موفقیت ذخیره شد!');
}


function showSection(id) {
  document.querySelectorAll('.public-section').forEach(sec => {
    sec.classList.add('hidden');
    sec.style.display = 'none';
  });
  const target = document.getElementById(id);
  if (target) {
    target.classList.remove('hidden');
    target.style.display = 'flex';
    target.scrollTop = 0;
  }
}

function saveBlogsToStorage() {
  const blogList = document.getElementById('blog-list');
  const blogs = Array.from(blogList.children).map(article => ({
    title: article.querySelector('h3').textContent,
    body: article.querySelector('p').textContent,
    category: article.getAttribute('data-category')
  }));
  localStorage.setItem('blogs', JSON.stringify(blogs));
}

async function loadBlogsFromStorage() {
  // این تابع برای پنل ادمین استفاده می‌شود (نمایش لیست بلاگ‌ها)
  const blogList = document.getElementById('blog-list');
  if (!blogList) return;
  blogList.innerHTML = '';

  // گرفتن داده‌ها از Firebase یا localStorage از طریق bridge
  const blogs = await window.storageBridge.loadBlogs?.() || [];
  if (!Array.isArray(blogs) || blogs.length === 0) return;

  // ساخت هر بلاگ
  blogs.forEach((entry, index) => {
    if (!entry) return;

    const category = entry.category || '';
    let title = '', body = '';

    // بررسی ساختار ترجمه‌ای (fa, en, ar)
    if (typeof entry.title === 'object') {
      title = entry.title.fa || entry.title.en || entry.title.ar || 'بدون عنوان';
    } else {
      title = entry.title || 'بدون عنوان';
    }

    if (typeof entry.body === 'object') {
      body = entry.body.fa || entry.body.en || entry.body.ar || '';
    } else {
      body = entry.body || '';
    }

    // ایجاد عنصر مقاله در پنل ادمین
    const article = document.createElement('article');
    article.setAttribute('data-category', category);

    const idAttr = entry.id ? `data-id="${entry.id}"` : `data-index="${index}"`;

    article.innerHTML = `
      <h3>${String(title)}</h3>
      <p>${String(body)}</p>
      <div style="display:flex;gap:8px;">
        <button class="delete-blog-btn" ${idAttr}>🗑️ حذف</button>
      </div>
    `;

    blogList.appendChild(article);

    // اتصال دکمه حذف
    const delBtn = article.querySelector('.delete-blog-btn');
    if (delBtn) {
      delBtn.addEventListener('click', async () => {
        const remoteId = delBtn.getAttribute('data-id');
        const idx = parseInt(delBtn.getAttribute('data-index'));
        await window.storageBridge.deleteBlog(remoteId, idx);
        loadBlogsFromStorage();  // بازخوانی لیست
        loadPublicBlogs();       // به‌روزرسانی نمایش عمومی
      });
    }
  });
}

let blogsLoadedOnce = false; // 🟢 متغیر کنترلی برای جلوگیری از دوباره لود شدن

async function loadPublicBlogs(forceReload = false) {
  const blogList = document.getElementById('public-blog-list');
  if (!blogList) return;

  // اگر قبلاً لود شده و دوباره فراخوانی شده، جلوگیری کن
  if (blogsLoadedOnce && !forceReload) return;

  // پاک کردن لیست قبلی برای اطمینان از حذف تکرارها
  blogList.innerHTML = '';

  const blogs = await window.storageBridge.loadBlogs?.() || [];
  if (!Array.isArray(blogs) || blogs.length === 0) return;

  const lang = document.documentElement.lang || 'en';

  blogs.forEach(blog => {
    if (!blog) return;

    let safeTitle = 'بدون عنوان';
    let safeBody = '';

    // ✅ انتخاب ترجمه مناسب
    if (typeof blog.title === 'object') {
      safeTitle = blog.title[lang] || blog.title.fa || blog.title.en || blog.title.ar || safeTitle;
    } else if (typeof blog.title === 'string') {
      safeTitle = blog.title;
    }

    if (typeof blog.body === 'object') {
      safeBody = blog.body[lang] || blog.body.fa || blog.body.en || blog.body.ar || '';
    } else if (typeof blog.body === 'string') {
      safeBody = blog.body;
    }

    // ✅ ساخت بلاگ
    const article = document.createElement('article');
    article.setAttribute('data-category', blog.category || '');
    article.innerHTML = `
      <h3>${String(safeTitle)}</h3>
      <p>${String(safeBody)}</p>
    `;

    blogList.appendChild(article);
  });

  // علامت‌گذاری که فقط یکبار لود شده
  blogsLoadedOnce = true;
}


function filterBlogs(cat) {
  document.querySelectorAll('#blog-list article').forEach(article => {
    article.style.display = article.getAttribute('data-category') === cat || cat === 'all' ? 'block' : 'none';
  });
  loadBlogsFromStorage();
}


async function translateLongText(text, targetLang) {
  const sentences = text.split(/(?<=[.؟!])\s+/);
  const translatedSentences = [];
  for (const sentence of sentences) {
    const translated = await translateText(sentence, targetLang);
    translatedSentences.push(translated);
  }
  return translatedSentences.join(' ');
}

// ✅ ترجمه خودکار محتوا (بلاگ یا درباره من)
async function autoTranslateContent(contentFa) {
  if (!contentFa || typeof contentFa !== "string") return { fa: "", en: "", ar: "" };

  const maxChunk = 400; // محدودیت MyMemory
  const chunks = contentFa.match(new RegExp(`.{1,${maxChunk}}`, "g")) || [];

  let en = "", ar = "";

  for (const chunk of chunks) {
    const enPart = await translateTextSmart(chunk, "fa", "en");
    const arPart = await translateTextSmart(chunk, "fa", "ar");
    en += enPart + " ";
    ar += arPart + " ";
    await new Promise(r => setTimeout(r, 1200)); // فاصله بین درخواست‌ها برای جلوگیری از 429
  }

  return {
    fa: contentFa,
    en: en.trim() || contentFa,
    ar: ar.trim() || contentFa
  };
}



function cleanText(t) {
  return t.replace(/^[\uFEFF\u200E\u200F\u202A-\u202E]+/, '').trim();
}

function decodeEntities(str) {
  if (!str) return ''; // اگر خالی بود، برگردون رشته خالی
  const txt = document.createElement("textarea");
  txt.innerHTML = str;
  return txt.value;
}

async function translateAboutSection() {
  const faText = document.getElementById('about-fa').textContent.trim();
  console.log("FA:", faText);

  const enRaw = await translateTextSmart(faText, 'fa', 'en');
  const arRaw = await translateTextSmart(faText, 'fa', 'ar');
  console.log("EN raw:", enRaw);
  console.log("AR raw:", arRaw);
console.log("EN raw:", enRaw);
  const enText = enRaw ? decodeEntities(enRaw) : '';
  const arText = arRaw ? decodeEntities(arRaw) : '';
  console.log("EN decoded:", enText);
  console.log("AR decoded:", arText);

  document.getElementById('about-en').textContent = enText;
  document.getElementById('about-ar').textContent = arText;
}

async function saveBlogWithTranslation(titleFa, bodyFa, category = "") {
  const title = await autoTranslateContent(titleFa);
  const body = await autoTranslateContent(bodyFa);

  const blog = { title, body, category, date: new Date().toISOString() };
  await window.storageBridge.saveBlog(blog);

  console.log("✅ Blog saved with translations:", blog);
  loadBlogsFromStorage();
  loadPublicBlogs();
}


async function addBlog() {
  const faTitle = document.getElementById('blog-title')?.value?.trim() || '';
  const faBody = document.getElementById('blog-body-fa')?.value?.trim() || '';
  const category = document.getElementById('blog-category')?.value || 'general';

  if (!faTitle || !faBody) {
    alert('❌ لطفاً عنوان و متن را وارد کنید.');
    return;
  }

  // ترجمه‌ها (اگر توابع ترجمه موجود باشند)
  let enTitle = faTitle, arTitle = faTitle;
  let enBody = faBody, arBody = faBody;
  if (typeof translateText === 'function') {
    try {
      enTitle = await translateText(faTitle, 'en');
      arTitle = await translateText(faTitle, 'ar');
      enBody = await translateLongText(faBody, 'en');
      arBody = await translateLongText(faBody, 'ar');
    } catch (e) {
      console.warn('Translation failed, continuing with original text.', e);
    }
  }

  const blog = {
    title: { fa: faTitle, en: enTitle, ar: arTitle },
    body: { fa: faBody, en: enBody, ar: arBody },
    category,
    date: new Date().toISOString()
  };

  // save via bridge (remote if configured, else localStorage)
  try {
    await window.storageBridge.saveBlog(blog);
    // پاک کردن فرم
    const t = document.getElementById('blog-title'); if (t) t.value = '';
    const b = document.getElementById('blog-body-fa'); if (b) b.value = '';
    loadBlogsFromStorage(); // reload admin list
    loadPublicBlogs(); // reload public view
  } catch (e) {
    console.error('Failed to save blog:', e);
    alert('خطا در ذخیره‌سازی مقاله.');
  }
}


function loadPortfolio() {
  const saved = localStorage.getItem('portfolio');
  if (!saved) return;

  const galleryTrack = document.querySelector('.gallery-track');
  if (!galleryTrack) return;

  galleryTrack.innerHTML = '';
  const items = JSON.parse(saved);
  items.forEach(({ title, link, image }) => {
    const a = document.createElement('a');
    a.href = link;
    a.target = '_blank';
    a.innerHTML = `<img src="${image}" alt="${title}" />`;
    galleryTrack.appendChild(a);
  });
}

function addPortfolio() {
  const title = document.getElementById('portfolio-title').value.trim();
  const link = document.getElementById('portfolio-link').value.trim();
  const image = document.getElementById('portfolio-image').value.trim();

  if (!title || !link || !image) {
    alert('Please fill in all fields.');
    return;
  }

  const item = { title, link, image };
  const saved = localStorage.getItem('portfolio');
  const portfolio = saved ? JSON.parse(saved) : [];
  portfolio.push(item);
  localStorage.setItem('portfolio', JSON.stringify(portfolio));

  loadPortfolio();

  document.getElementById('portfolio-title').value = '';
  document.getElementById('portfolio-link').value = '';
  document.getElementById('portfolio-image').value = '';
}

function loadPortfolioAdmin() {
  const saved = localStorage.getItem('portfolio');
  const portfolio = saved ? JSON.parse(saved) : [];
  const list = document.getElementById('portfolio-list');
  list.innerHTML = '';

  portfolio.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'portfolio-admin-item';
    div.innerHTML = `
      <img src="${item.image}" alt="${item.title}" />
      <div class="portfolio-admin-info">
        <strong>${item.title}</strong>
        <button onclick="editPortfolio(${index})">✏️ Edit</button>
        <button onclick="deletePortfolio(${index})">🗑️ Delete</button>
      </div>
    `;
    list.appendChild(div);
  });
}

function deletePortfolio(index) {
  const saved = localStorage.getItem('portfolio');
  const portfolio = saved ? JSON.parse(saved) : [];
  portfolio.splice(index, 1);
  localStorage.setItem('portfolio', JSON.stringify(portfolio));
  loadPortfolio();
  loadPortfolioAdmin();
}

function editPortfolio(index) {
  const saved = localStorage.getItem('portfolio');
  const portfolio = saved ? JSON.parse(saved) : [];
  const item = portfolio[index];

  document.getElementById('portfolio-title').value = item.title;
  document.getElementById('portfolio-link').value = item.link;
  document.getElementById('portfolio-image').value = item.image;

  portfolio.splice(index, 1);
  localStorage.setItem('portfolio', JSON.stringify(portfolio));
  loadPortfolio();
  loadPortfolioAdmin();
}

function openPreview(path) {
  const viewer = document.getElementById('portfolio-viewer');
  viewer.innerHTML = `<iframe src="${path}" frameborder="0"></iframe>`;
  viewer.style.display = 'block';
}

async function translateTextSmart(text, source = "fa", target = "en") {
  if (!text || typeof text !== "string") return "";
  try {
    const res = await fetch("https://script.google.com/macros/s/AKfycbzQP25LIwXN_fZnBwXkGxc5ww7gHOtPgz3A7hHfehgl9uZs8lrgcSPXNXcCOJSaj3AB/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        text,
        target,
        key: "IliyaTranslate2025" // ✅ همان کلیدی که در Apps Script گذاشتی
      })
    });

    const data = await res.json();
    if (data.translatedText) return data.translatedText;
    console.warn("Translation failed:", data.error || "Unknown error");
    return text;
  } catch (err) {
    console.error("🔥 Translation error:", err);
    return text;
  }
}



// تابع جدید برای درباره‌من (با ترجمه خودکار بهینه)
async function saveAbout(faText) {
  const fa = (faText || document.getElementById('about-fa')?.value || '').trim();
  if (!fa) {
    alert('لطفا متن درباره من را وارد کنید.');
    return;
  }

  // ✅ ترجمه با نسخه‌ی بهینه
  let enText = fa, arText = fa;
  try {
    enText = await translateTextSmart(fa, 'fa', 'en');
    arText = await translateTextSmart(fa, 'fa', 'ar');
  } catch (e) {
    console.warn('translateAbout failed', e);
  }

  const aboutData = { fa, en: enText, ar: arText, updated: new Date().toISOString() };
  await window.storageBridge.saveAbout(aboutData);

  // ✅ به‌روزرسانی لحظه‌ای در صفحه
  document.getElementById('about-fa') && (document.getElementById('about-fa').textContent = fa);
  document.getElementById('about-en') && (document.getElementById('about-en').textContent = enText);
  document.getElementById('about-ar') && (document.getElementById('about-ar').textContent = arText);

  alert('✅ متن درباره من ذخیره و ترجمه شد.');
  console.log("✅ About section translated and saved:", aboutData);
}



function loadAbout() {
  const saved = localStorage.getItem('aboutSection');
  if (!saved) return;

  const about = JSON.parse(saved);
  document.getElementById('about-fa').textContent = about.fa;
  document.getElementById('about-en').textContent = about.en;
  document.getElementById('about-ar').textContent = about.ar;
}

function toggleLanguageMenu() {
  const menu = document.getElementById('language-menu');
  menu.classList.toggle('show');
}

function setLanguage(lang) {
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === 'fa' || lang === 'ar' ? 'rtl' : 'ltr';

  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (translations[lang][key]) {
      el.textContent = translations[lang][key];
    }
  });
  localStorage.setItem('selectedLanguage', lang);
  loadPublicBlogs();
  showAboutByLang(lang);
  applyTranslations(lang)

}

function toggleMenu() {
  const menu = document.querySelector('.menu');
  menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
}

function scrollGallery(direction) {
  const track = document.querySelector('.gallery-track');
  const scrollAmount = 300;
  track.scrollBy({ left: direction * scrollAmount, behavior: 'smooth' });
}

// let startX = 0;
// document.querySelector('.gallery-track').addEventListener('touchstart', e => {
//   startX = e.touches[0].clientX;
// });

// document.querySelector('.gallery-track').addEventListener('touchend', e => {
//   const endX = e.changedTouches[0].clientX;
//   const delta = startX - endX;
//   if (Math.abs(delta) > 50) {
//     scrollGallery(delta > 0 ? 1 : -1);
//   }
// }
// );
let startX = 0;
const galleryTrackEl = document.querySelector('.gallery-track');
if (galleryTrackEl) {
  galleryTrackEl.addEventListener('touchstart', e => {
    startX = e.touches[0].clientX;
  });

  galleryTrackEl.addEventListener('touchend', e => {
    const endX = e.changedTouches[0].clientX;
    const delta = startX - endX;
    if (Math.abs(delta) > 50) {
      scrollGallery(delta > 0 ? 1 : -1);
    }
  });
}


function showAboutByLang(lang) {
  document.getElementById('about-fa').classList.add('hidden');
  document.getElementById('about-en').classList.add('hidden');
  document.getElementById('about-ar').classList.add('hidden');

  if (lang === 'fa') {
    document.getElementById('about-fa').classList.remove('hidden');
  } else if (lang === 'en') {
    document.getElementById('about-en').classList.remove('hidden');
  } else if (lang === 'ar') {
    document.getElementById('about-ar').classList.remove('hidden');
  }
}

function loadAbout() {
  const saved = localStorage.getItem('aboutSection');
  if (!saved) return;
  const about = JSON.parse(saved);

  document.getElementById('about-fa').textContent = about.fa;
  document.getElementById('about-en').textContent = about.en;
  document.getElementById('about-ar').textContent = about.ar;
}
 </script>

 <!-- ===== Firebase bridge  ===== -->
<script type="module">

 const firebaseConfig = {
  apiKey: "AIzaSyB-_AtMVlICupwsLg-dAjfoO6cH-ItE5ls",
  authDomain: "iliya-official.firebaseapp.com",
  projectId: "iliya-official",
  databaseURL:"https://iliya-official-default-rtdb.asia-southeast1.firebasedatabase.app",
  storageBucket: "iliya-official.firebasestorage.app",
  messagingSenderId: "525136175554",
  appId: "1:525136175554:web:d3ef4c5cf938789bde765b",
  measurementId: "G-NQQJE2NVP1"
};
  // ========================================================================

  // حالت: اگر مقادیر واقعی را وارد نکردی، firebaseAvailable=false می‌ماند و fallback به localStorage انجام می‌شود
  let firebaseAvailable = false;

  // تابع کمکی برای بررسی آیا config پر شده یا نه
  function isFirebaseConfigSet(cfg) {
    return cfg && cfg.apiKey && cfg.databaseURL && cfg.projectId && cfg.appId;
  }

  if (isFirebaseConfigSet(firebaseConfig)) {
    try {
      import("https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js").then(({ initializeApp }) => {
        return Promise.all([
          Promise.resolve(initializeApp(firebaseConfig)),
          import("https://www.gstatic.com/firebasejs/11.8.0/firebase-database.js")
        ]);
      }).then(([appModule, dbModule]) => {
        // dbModule شامل getDatabase, ref, push, get, remove, set است
        const { getDatabase, ref, push, get, remove, set, child } = dbModule;
        const db = getDatabase();

        // توابع remote را به window متصل می‌کنیم (فقط اگر firebase قابل استفاده باشد)
        window.remote = {
          async saveBlogRemote(blogData) {
            const blogsRef = ref(db, 'blogs');
            await push(blogsRef, blogData);
            return true;
          },
          async loadBlogsRemote() {
            const blogsRef = ref(db, 'blogs');
            const snap = await get(blogsRef);
            if (!snap.exists()) return [];
            const val = snap.val();
            // تبدیل object -> array با id
            return Object.keys(val).map(key => ({ id: key, ...val[key] }));
          },
          async deleteBlogRemote(id) {
            if (!id) return false;
            const itemRef = ref(db, `blogs/${id}`);
            await remove(itemRef);
            return true;
          },
          async saveAboutRemote(key, data) {
            // نگه داشتن aboutSection در کلید about
            const aboutRef = ref(db, `about/${key || 'main'}`);
            await set(aboutRef, data);
            return true;
          },
          async loadAboutRemote() {
            const aboutRef = ref(db, 'about');
            const snap = await get(aboutRef);
            if (!snap.exists()) return null;
            return snap.val();
          }
        };

        firebaseAvailable = true;
        console.info("Firebase bridge: connected and available.");
      }).catch(err => {
        console.warn("Firebase bridge: failed to initialize, fallback to localStorage.", err);
      });
    } catch (e) {
      console.warn("Firebase bridge: exception, fallback to localStorage.", e);
    }
  } else {
    console.info("Firebase bridge: no config set — using localStorage fallback.");
  }

  // Helper عمومی برای ذخیره/لود با fallback
  window.storageBridge = {
    // تلاش کن اول remote، اگر نبود localStorage
    async saveBlog(blogData) {
      if (firebaseAvailable && window.remote?.saveBlogRemote) {
        try {
          await window.remote.saveBlogRemote(blogData);
          return { remote: true };
        } catch (e) {
          console.warn("saveBlog remote failed, using localStorage", e);
        }
      }
      // fallback local
      const saved = localStorage.getItem('blogs');
      const arr = saved ? JSON.parse(saved) : [];
      arr.push(blogData);
      localStorage.setItem('blogs', JSON.stringify(arr));
      return { remote: false };
    },

    async loadBlogs() {
      if (firebaseAvailable && window.remote?.loadBlogsRemote) {
        try {
          const items = await window.remote.loadBlogsRemote();
          // normalize => array of { title:{...}, body:{...}, date, id? }
          return items.map(it => {
            // if data stored as value without id, pass through
            return it;
          });
        } catch (e) {
          console.warn("loadBlogs remote failed, using localStorage", e);
        }
      }
      const saved = localStorage.getItem('blogs');
      return saved ? JSON.parse(saved) : [];
    },

    async deleteBlog(id, indexFallback) {
      if (firebaseAvailable && id && window.remote?.deleteBlogRemote) {
        try {
          await window.remote.deleteBlogRemote(id);
          return { remote: true };
        } catch (e) {
          console.warn("deleteBlog remote failed, fallback to local", e);
        }
      }
      // fallback: حذف از localStorage با index
      const saved = localStorage.getItem('blogs');
      if (!saved) return { remote: false };
      const arr = JSON.parse(saved);
      if (typeof indexFallback === 'number') {
        arr.splice(indexFallback, 1);
        localStorage.setItem('blogs', JSON.stringify(arr));
      } else {
        // اگر id ندارد، حذف اولین مشابه
        localStorage.setItem('blogs', JSON.stringify(arr));
      }
      return { remote: false };
    },

    async saveAbout(data) {
      if (firebaseAvailable && window.remote?.saveAboutRemote) {
        try {
          await window.remote.saveAboutRemote('main', data);
          return { remote: true };
        } catch (e) {
          console.warn("saveAbout remote failed, fallback to local", e);
        }
      }
      localStorage.setItem('aboutSection', JSON.stringify(data));
      return { remote: false };
    },

    async loadAbout() {
      if (firebaseAvailable && window.remote?.loadAboutRemote) {
        try {
          const val = await window.remote.loadAboutRemote();
          return val || null;
        } catch (e) {
          console.warn("loadAbout remote failed, fallback to local", e);
        }
      }
      const saved = localStorage.getItem('aboutSection');
      return saved ? JSON.parse(saved) : null;
    }

  };

</script>
<!-- ===== end Firebase bridge ===== -->

</body>
</html>
