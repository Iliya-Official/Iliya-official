<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iliya Portfolio</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/png" href="assets/logo/mylogo3.png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
  <header class="main-header">
    <div class="header-center">
      <div class="logo-title" onclick="toggleAdminLogin()">
        <img src="assets/logo/mylogo3.png" loading="lazy" alt="Logo" class="logo-icon" />
        <h1 style="color: black;">Iliya Rad</h1>
      </div>
  <!-- <div class="language-switcher">
  <button class="language-btn" onclick="toggleLanguageMenu()">
    <i class="fas fa-globe"></i> 
  </button>
  <ul id="language-menu" class="language-menu">
    <li onclick="setLanguage('en')">
      <img src="https://flagcdn.com/w20/gb.png" alt="EN" class="flag-icon" /> EN
    </li>
    <li onclick="setLanguage('fa')">
      <img src="https://flagcdn.com/w20/ir.png" alt="FA" class="flag-icon" /> FA
    </li>
    <li onclick="setLanguage('ar')">
      <img src="https://flagcdn.com/w20/sa.png" alt="AR" class="flag-icon" /> AR
    </li>
  </ul>
</div> -->
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
  <div class="sidebar-top">
    <div class="coin-wrapper">
      <div class="coin">
        <img src="assets/image/mypic.png" loading="lazy" alt="Logo" class="coin-face front" />
        <img src="assets/logo/mylogo3.png" loading="lazy" alt="Profile" class="coin-face back" />
      </div>
    </div>
    <button class="hamburger" onclick="toggleMenu()">â˜°</button>
  </div>

  <nav class="menu">
    <a href="#" onclick="showSection('about')" data-i18n="about">About Me</a>
    <a href="#" onclick="showSection('public-blog')" data-i18n="blog">Blog</a>
    <a href="#" onclick="showSection('portfolio')" data-i18n="portfolio">Portfolio</a>
    <a href="#" onclick="showSection('contact')" data-i18n="contact">Contact</a>
  </nav>
</aside>

    <main class="main-content">
     <section id="about" class="public-section hidden">
  <!-- ÙˆÛŒØ¯ÛŒÙˆ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ -->
  <video autoplay muted loop playsinline preload="none" class="about-bg-video">
    <source src="assets/backvid-about/coding.mp4" type="video/mp4">
    Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ø§Ø² ÙˆÛŒØ¯ÛŒÙˆ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
  </video>
  <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù…ØªÙ† -->
  <div class="about-content">
    <p id="about-en"></p>
  </div>
</section>
      <section id="blog" class="public-section hidden" data-i18n="blogContent"></section>
      <div id="public-blog" class="public-section hidden">
      <div id="public-blog-list" class="blog-list"></div>
      </div>
      <!-- <section id="portfolio" class="content-section" data-i18n="portfolioContent">Portfolio gallery will appear here.</section> -->
       <section id="portfolio" class="public-section portfolio-gallery hidden" data-i18n="portfolioContent">
  <div class="gallery-wrapper">
    <button class="nav-btn left" onclick="scrollGallery(-1)">&#8592;</button>
    <div class="gallery-track">
      <!-- <a href="assets/samples/sampel1/link/startbootstrap-creative-gh-pages/index.html" target="_blank"><img src="assets/samples/sampel1/img/Screenshot -ghoghnoos.png" alt="Site 1" /></a> -->
      <!-- <a href="https://example2.com" target="_blank"><img src="assets/samples/site2.png" alt="Site 2" /></a>
      <a href="https://example3.com" target="_blank"><img src="assets/samples/site3.png" alt="Site 3" /></a> -->
      
    </div>
    <button class="nav-btn right" onclick="scrollGallery(1)">&#8594;</button>
  </div>
</section>
      <section id="contact" class="public-section contact-layout hidden">
        <form class="contact-form" action="https://formsubmit.co/alirezamotieerad@gmail.com" method="POST">
        <input type="text" name="name" placeholder="Your Name" required />
        <input type="email" name="email" placeholder="Your Email" required />
        <textarea name="message" placeholder="Your Message" required></textarea>
        <button type="submit" data-i18n="send">Send</button>
         </form>
        <div class="contact-info">
          <div class="contact-info">
         <p data-i18n="phone"><a href="tel:+96879696086">+96879696086</a></p>
         <p data-i18n="email"><a href="mailto:alirezamotieerad@gmail.com">alirezamotieerad@gmail.com</a></p>
         </div>
          <div class="social-links">
            <a href="https://github.com/Iliya-Official" target="_blank"><i class="fab fa-github"></i></a>
            <a href="https://linkedin.com/in/iliya-rad-783b0b281" target="_blank"><i class="fab fa-linkedin"></i></a>
            <a href="https://wa.me/+96879696086" target="_blank"><i class="fab fa-whatsapp"></i></a>
          </div>
        </div>
      </section>

     <div id="admin-login" class="admin-login hidden">
  <h2>ğŸ” Admin Login</h2>
  <form id="admin-form">
    <input type="text" id="adminUser" placeholder="Username" autocomplete="off" />
    <input type="password" id="adminPass" placeholder="Password" autocomplete="new-password" />
    <button type="submit">ğŸ” Login</button>
  </form>
  <button id="admin-logout-btn" onclick="performLogout()" class="hidden">ğŸšª Logout</button>
</div>

<section id="admin-panel" class="content-section hidden">
  <div class="admin-header">
    <div class="admin-tabs">
      <button onclick="showAdminTab('about-tab')">Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù†</button>
      <button onclick="showAdminTab('blog-tab')">Ø¨Ù„Ø§Ú¯</button>
      <button onclick="showAdminTab('portfolio-tab')">Ù†Ù…ÙˆÙ†Ù‡â€ŒÚ©Ø§Ø±Ù‡Ø§</button>
      <button onclick="showAdminTab('contact-tab')">Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ù†</button>
      <button onclick="showAdminTab('settings-tab')">ØªØºÛŒÛŒØ± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</button>
    </div>
    <!-- <button id="admin-logout-btn" onclick="logoutAdmin()">ğŸ”Œ Ø®Ø±ÙˆØ¬</button> -->
  </div>

 <div id="about-tab" class="admin-tab hidden">
  <h3>âœï¸ Edit â€œAbout Meâ€ Section</h3>

  <div class="about-editor">
    <div class="editor-toolbar">
      <button type="button" onclick="formatText('bold')" title="Bold"><b>B</b></button>
      <button type="button" onclick="formatText('italic')" title="Italic"><i>I</i></button>
      <button type="button" onclick="formatText('underline')" title="Underline"><u>U</u></button>
      <button type="button" onclick="formatText('insertUnorderedList')" title="Bullet List">â€¢ List</button>
      <button type="button" onclick="addLink()" title="Insert Link">ğŸ”—</button>
      <button type="button" onclick="formatText('justifyLeft')" title="Align Left">â¬…</button>
      <button type="button" onclick="formatText('justifyCenter')" title="Align Center">â†”</button>
      <button type="button" onclick="formatText('justifyRight')" title="Align Right">â¡</button>
    </div>

    <div id="about-editor" class="editable-area" contenteditable="true" placeholder="Write about yourself here..."></div>
    <button class="save-about-btn" onclick="saveAboutFromEditor()">ğŸ’¾ Save About</button>

    <!-- Ù„ÛŒØ³Øª Ù…ØªÙ†â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ -->
    <div class="saved-about-list">
      <h3>Saved About Texts</h3>
      <div id="about-items-list"></div>
    </div>
  </div>
</div>



  <div id="blog-tab" class="admin-tab hidden">
    <h2>ğŸ“ Add New Blog Post</h2>
    <input type="text" id="blog-title" placeholder="Blog Title" />
    <select id="blog-category">
      <option value="general">General</option>
      <option value="tech">Tech</option>
      <option value="design">Design</option>
    </select>

    <div class="editor-container">
      <div class="editor-toolbar">
        <button type="button" onclick="execCmd('bold')"><b>B</b></button>
        <button type="button" onclick="execCmd('italic')"><i>I</i></button>
        <button type="button" onclick="execCmd('underline')"><u>U</u></button>
        <button type="button" onclick="execCmd('insertUnorderedList')">â€¢ List</button>
        <button type="button" onclick="execCmd('insertOrderedList')">1. List</button>
        <button type="button" onclick="execCmd('createLink', prompt('Enter URL:'))">ğŸ”— Link</button>
        <button type="button" onclick="execCmd('removeFormat')">ğŸ§¹ Clear</button>
      </div>
      <div id="blog-body-editor" class="editor-area" contenteditable="true"></div>
    </div>
    <button id="blog-add-btn" onclick="addBlog()">Add Blog</button>

    <!-- Saved Blog Posts List -->
    <div class="saved-blog-list">
      <h3>Saved Blog Posts</h3>
      <div id="blog-items-list" class="blog-items-list"></div>
    </div>
  </div>

<div id="portfolio-tab" class="admin-tab hidden">
  <h2>ğŸ¨ Manage Portfolio</h2>

  <div class="portfolio-form">
    <input type="text" id="portfolio-title" placeholder="Project Title" />

    <div class="portfolio-inputs">
      <label>ğŸ”— Project Link (optional):</label>
      <input type="url" id="portfolio-link" placeholder="https://github.com/username/project" />
    </div>

    <div class="portfolio-upload">
      <label>ğŸ–¼ï¸ Upload Image Preview:</label>
      <input type="file" id="portfolio-image-file" accept="image/*" onchange="previewPortfolioImage(event)" />
      <img id="portfolio-preview" src="" alt="Preview" class="portfolio-preview hidden" />
      <input type="url" id="portfolio-image" placeholder="Or Image URL (optional)" />
    </div>

    <div class="portfolio-files-upload">
      <label>ğŸ“ Upload Project Files:</label>
      <input type="file" id="portfolio-files" multiple onchange="handleProjectFiles(event)" />
      <div id="uploaded-files-list" class="uploaded-files-list"></div>
    </div>

    <button id="portfolio-save-btn" onclick="addPortfolio()">ğŸ’¾ Save Portfolio</button>
  </div>

  <hr />
  <h3>ğŸ“ Your Portfolio Items</h3>
  <div id="portfolio-list" class="portfolio-list"></div>
</div>

  <div id="contact-tab" class="admin-tab hidden">
  <h3>ğŸ“ Contact Information</h3>

  <div class="contact-admin-form">
    <label>ğŸ“± Phone Number:</label>
    <input type="text" id="admin-phone" placeholder="Enter your phone number" />

    <label>ğŸ“§ Email Address:</label>
    <input type="email" id="admin-email" placeholder="Enter your email address" />

    <label>ğŸ”— Social Media / Website:</label>
    <input type="text" id="admin-social" placeholder="e.g. https://linkedin.com/in/yourname" />

    <button id="save-contact-btn" onclick="saveContactInfo()">ğŸ’¾ Save Contact Info</button>
  </div>
</div>


 <div id="settings-tab" class="admin-tab hidden">
  <h3>ğŸ” Change Admin Credentials</h3>

  <div class="settings-form">
    <label>ğŸ‘¤ New Username (Email):</label>
    <input type="text" id="new-username" placeholder="Enter new admin email" />

    <label>ğŸ”‘ New Password:</label>
    <input type="password" id="new-password" placeholder="Enter new password" />

    <button id="update-credentials-btn" onclick="updateAdminCredentials()">ğŸ’¾ Save Changes</button>
  </div>
</div>

</section>

 </div>
  <!-- âœ… ÙÙˆØªØ± Ø¯Ø§Ø®Ù„ main-content -->
      <footer class="site-footer">
         <p>Â© 2025 Iliya Rad. All rights reserved.</p>
      </footer>

      
    </main>
    
  </div>
 

<script>
/* In-page notifier: showNotification(message, type:'info'|'success'|'error'|'warning', timeoutMs)
   Minimal, self-contained so we avoid alert() popups and have consistent UX. */
function showNotification(message, type = 'info', timeout = 3000) {
  try {
    const el = document.createElement('div');
    el.className = 'site-notify site-notify-' + type;
    el.textContent = message;
    Object.assign(el.style, {
      position: 'fixed',
      right: '20px',
      top: '20px',
      padding: '10px 14px',
      background: type === 'error' ? '#f44336' : (type === 'success' ? '#4CAF50' : (type === 'warning' ? '#ff9800' : '#333')),
      color: '#fff',
      borderRadius: '6px',
      boxShadow: '0 6px 18px rgba(0,0,0,0.12)',
      zIndex: 99999,
      opacity: '1',
      transition: 'opacity 0.3s ease'
    });
    document.body.appendChild(el);
    setTimeout(() => { el.style.opacity = '0'; setTimeout(() => el.remove(), 300); }, timeout);
    return el;
  } catch (e) { console.warn('notify failed', e); }
}

/* Modal for showing full blog posts when 'Continue reading' is clicked */
function showBlogModal(title, html) {
  let modal = document.getElementById('blog-modal');
  if (!modal) {
    modal = document.createElement('div');
    modal.id = 'blog-modal';
    Object.assign(modal.style, {
      position: 'fixed', left: 0, top: 0, right: 0, bottom: 0,
      background: 'rgba(0,0,0,0.6)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 99998
    });
    const box = document.createElement('div');
    box.id = 'blog-modal-box';
    Object.assign(box.style, { background: '#fff', color: '#000', padding: '20px', borderRadius: '8px', maxWidth: '900px', maxHeight: '80vh', overflowY: 'auto' });
    const close = document.createElement('button');
    close.textContent = 'Close';
    Object.assign(close.style, { float: 'right', marginBottom: '10px' });
    close.onclick = () => modal.remove();
    box.appendChild(close);
    const h = document.createElement('h2'); h.id = 'blog-modal-title'; box.appendChild(h);
    const c = document.createElement('div'); c.id = 'blog-modal-content'; box.appendChild(c);
    modal.appendChild(box);
    document.body.appendChild(modal);
  }
  document.getElementById('blog-modal-title').textContent = title || '';
  document.getElementById('blog-modal-content').innerHTML = html || '';
  modal.style.display = 'flex';
}

/* --- Robust typing effect: types HTML safely (preserves tags, no duplication) --- */
function typeText(element, html, speed = 28) {
  if (!element || typeof html !== 'string') return;

  // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¯Ùˆ ØªØ§ÛŒÙ¾ Ù…ØªØ¯Ø§Ø®Ù„
  if (window._aboutTyping) {
    // Ø§Ú¯Ø± Ø¯Ø± Ø­Ø§Ù„ ØªØ§ÛŒÙ¾ Ø§Ø³ØªØŒ Ø¢Ù† Ø±Ø§ Ù„ØºÙˆ Ú©Ù† Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ø¬Ø±Ø§ Ú©Ù†
    clearInterval(window._aboutTypingInterval);
    window._aboutTyping = false;
  }
  window._aboutTyping = true;

  // Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯Ù† Ù…Ø­ØªÙˆØ§ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø§Ù…Ù†
  element.innerHTML = '';

  // ØªØ¨Ø¯ÛŒÙ„ HTML Ø¨Ù‡ ÛŒÚ© DOM Ù…ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÙ…Ø§ÛŒØ´ Ø¨Ø¯ÙˆÙ† Ø¯Ø±Ø¬ Ù…Ø³ØªÙ‚ÛŒÙ… innerHTML
  const temp = document.createElement('div');
  temp.innerHTML = html;

  // ØµÙ Ø§Ø² Ú¯Ø±Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø´ÙˆÙ†Ø¯ (node, parentInTarget)
  const work = [];
  // Ù‡Ø± Ú¯Ø±Ù‡ ÙØ±Ø²Ù†Ø¯ temp Ø±Ø§ Ø¨Ø§ parent Ù‡Ø¯Ù (element) Ø´Ø±ÙˆØ¹ Ú©Ù†
  Array.from(temp.childNodes).forEach(n => work.push({ node: n, parent: element }));

  // ØªØ§Ø¨Ø¹ÛŒ Ú©Ù‡ ÛŒÚ© Ú©Ø§Ø±Ø§Ú©ØªØ± Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ (Ø¨Ø±Ø§ÛŒ Ù…ØªÙ†)
  function appendChar(parent, ch) {
    // Ø§Ú¯Ø± Ø¢Ø®Ø±ÛŒÙ† ÙØ±Ø²Ù†Ø¯ ÛŒÚ© text node Ù‡Ø³ØªØŒ Ø¨Ù‡ Ø¢Ù† Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø§ÛŒÛŒ Ø¨Ù‡ØªØ±
    const last = parent.lastChild;
    if (last && last.nodeType === Node.TEXT_NODE) {
      last.textContent += ch;
    } else {
      parent.appendChild(document.createTextNode(ch));
    }
  }

  // Ù¾ÛŒÙ…Ø§ÛŒØ´ ØªØ±ØªÛŒØ¨ÛŒ: Ù‡Ø± ØªÛŒÚ© ÛŒÚ© Ú©Ø§Ø±Ø§Ú©ØªØ± ÛŒØ§ ÛŒÚ© Ú¯Ø±Ù‡ Ø±Ø§ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ø¯
  window._aboutTypingInterval = setInterval(() => {
    if (work.length === 0) {
      clearInterval(window._aboutTypingInterval);
      window._aboutTyping = false;
      return;
    }

    const top = work[0];

    // Ø§Ú¯Ø± node ÛŒÚ© Ù…ØªÙ† Ø§Ø³Øª => Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ù‡ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¢Ù† Ø±Ø§ Ø¨Ù‡ parent Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    if (top.node.nodeType === Node.TEXT_NODE) {
      const txt = top.node.textContent || '';
      if (!top._pos) top._pos = 0;
      if (top._pos < txt.length) {
        appendChar(top.parent, txt.charAt(top._pos));
        top._pos++;
        return; // ÛŒÚ© Ú©Ø§Ø±Ø§Ú©ØªØ± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ØŒ Ø¯Ø± Ø§ÛŒÙ† ØªÛŒÚ© Ø¨Ù…Ø§Ù†
      } else {
        // Ù…ØªÙ† ØªÙ…Ø§Ù… Ø´Ø¯ => Ø§ÛŒÙ† Ú©Ø§Ø± Ú©Ø§Ù…Ù„ Ø´Ø¯Ù‡ØŒ Ø¢Ù† Ø±Ø§ Ø§Ø² ØµÙ Ø¨Ø±Ø¯Ø§Ø±
        work.shift();
        return;
      }
    }

    // Ø§Ú¯Ø± node ÛŒÚ© Ø§Ù„Ù…Ù†Øª Ø§Ø³Øª => ÛŒÚ© clone Ø®Ø§Ù„ÛŒ Ø¨Ø³Ø§Ø²ØŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ØŒ Ø³Ù¾Ø³ ÙØ±Ø²Ù†Ø¯Ø§Ù†Ø´ Ø±Ø§ Ø¨Ù‡ ØµÙ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
    if (top.node.nodeType === Node.ELEMENT_NODE) {
      const el = document.createElement(top.node.nodeName.toLowerCase());
      // Ú©Ù¾ÛŒ Ø§ØªØ±ÛŒØ¨ÛŒÙˆØªâ€ŒÙ‡Ø§
      Array.from(top.node.attributes || []).forEach(attr => el.setAttribute(attr.name, attr.value));
      top.parent.appendChild(el);

      // Ø­Ø°Ù Ú¯Ø±Ù‡ ÙØ¹Ù„ÛŒ Ùˆ Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† ÙØ±Ø²Ù†Ø¯Ø§Ù† Ø¢Ù† Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ÛŒ ØµÙ (ØªØ§ ØªØ±ØªÛŒØ¨ Ø­ÙØ¸ Ø´ÙˆØ¯)
      work.shift();
      // Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† ÙØ±Ø²Ù†Ø¯Ø§Ù† Ø¨Ù‡ Ø§Ø¨ØªØ¯Ø§ÛŒ ØµÙ Ø¨Ù‡ ØµÙˆØ±Øª ÙˆØ§Ø±ÙˆÙ†Ù‡ ØªØ§ ØªØ±ØªÛŒØ¨ Ù†Ù‡Ø§ÛŒÛŒ Ø¯Ø±Ø³Øª Ø¨Ø§Ø´Ø¯
      const children = Array.from(top.node.childNodes);
      for (let i = children.length - 1; i >= 0; i--) {
        work.unshift({ node: children[i], parent: el });
      }
      return;
    }

    // Ø³Ø§ÛŒØ± Ù†ÙˆØ¹â€ŒÙ‡Ø§ÛŒ Ù†ÙˆØ¯ (ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ù†Ø§Ø¯Ø±) Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†
    work.shift();
  }, speed);
}

 

/* show public section */
function showSection(id) {
  document.querySelectorAll('.public-section').forEach(sec => { 
    sec.classList.add('hidden'); 
    sec.style.display = 'none'; 
  });
  
  const target = document.getElementById(id);
  if (target) {
    target.classList.remove('hidden');
    target.style.display = 'flex';
    target.scrollTop = 0;
    
    // Load blogs when showing the public blog section
    if (id === 'public-blog') {
      loadPublicBlogs();
    }
    // Load about when showing about section
    if (id === 'about') {
      loadAbout();
    }
  }
}
window.showSection = showSection;

/* toggle admin login box (called from logo click) */
function toggleAdminLogin() {
  const box = document.getElementById('admin-login');
  if (box) box.classList.toggle('hidden');
}
window.toggleAdminLogin = toggleAdminLogin;

/* Toggle mobile menu (hamburger) - ensures menu appears on small screens */
function toggleMenu() {
  const menu = document.querySelector('.menu');
  if (!menu) return;
  menu.classList.toggle('show');
  // if show, force display flex (menu CSS controls layout)
  if (menu.classList.contains('show')) {
    menu.style.display = 'flex';
  } else {
    menu.style.display = '';
  }
}
window.toggleMenu = toggleMenu;

function showAdminTab(id) {
  document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.classList.add('hidden');
    tab.style.display = 'none';
  });
  const t = document.getElementById(id);
  if (t) {
    t.classList.remove('hidden');
    t.style.display = 'block';
  }
}
window.showAdminTab = showAdminTab;

/* ==== UPDATE ADMIN CREDENTIALS (Firebase Auth) ==== */
async function updateAdminCredentials() {
  const newEmail = document.getElementById('new-username').value.trim();
  const newPassword = document.getElementById('new-password').value.trim();

  if (!firebaseAuth?.currentUser) {
    showNotification("âš ï¸ You must be logged in as admin to change credentials.", 'warning');
    return;
  }

  try {
    if (newEmail) {
      await window.firebaseAuth.currentUser.updateEmail(newEmail);
      console.info('âœ… Email updated:', newEmail);
    }

    if (newPassword) {
      await window.firebaseAuth.currentUser.updatePassword(newPassword);
      console.info('âœ… Password updated');
    }

  showNotification("âœ… Credentials updated successfully!", 'success');
  } catch (error) {
    console.error("âŒ updateAdminCredentials failed:", error);
    if (error.code === "auth/requires-recent-login") {
  showNotification("âš ï¸ Please log out and log back in before changing credentials.", 'warning');
    } else if (error.code === "auth/invalid-email") {
  showNotification("âŒ Invalid email format.", 'error');
    } else if (error.code === "auth/weak-password") {
  showNotification("âŒ Password should be at least 6 characters.", 'error');
    } else {
  showNotification("Error: " + error.message, 'error');
    }
  }
}


/* ==== CONTACT INFO FUNCTIONS ==== */
async function loadContactInfo() {
  try {
    const contactData = await window.storageBridge.loadContact();
    if (contactData) {
      document.getElementById('admin-phone').value = contactData.phone || '';
      document.getElementById('admin-email').value = contactData.email || '';
      document.getElementById('admin-social').value = contactData.social || '';
    }
  } catch (e) {
    console.warn("âš ï¸ loadContactInfo failed:", e);
  }
}

async function saveContactInfo() {
  const phone = document.getElementById('admin-phone').value.trim();
  const email = document.getElementById('admin-email').value.trim();
  const social = document.getElementById('admin-social').value.trim();

  if (!phone || !email) { showNotification('âš ï¸ Please fill both phone and email.', 'warning'); return; }

  const contactData = { phone, email, social, updated: new Date().toISOString() };

  try {
    await window.storageBridge.saveContact(contactData);
  showNotification('âœ… Contact info saved to Firebase.', 'success');
  } catch (e) {
    console.error('âŒ saveContactInfo failed:', e);
  showNotification('Error saving contact info.', 'error');
  }
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø² Ø´Ø¯Ù† ØªØ¨
window.addEventListener('DOMContentLoaded', loadContactInfo);


/* show admin panel after successful login */
function showAdminPanelAfterLogin() {
  const loginBox = document.getElementById('admin-login');
  const adminPanel = document.getElementById('admin-panel');
  if (loginBox) loginBox.classList.add('hidden');
  if (adminPanel) {
    adminPanel.classList.remove('hidden');
    adminPanel.style.display = 'block';
  }
  document.querySelectorAll('#admin-logout-btn').forEach(btn => btn.classList.remove('hidden'));
  // hide public sections entirely
  document.querySelectorAll('.public-section').forEach(sec => { sec.classList.add('hidden'); sec.style.display = 'none'; });
  // show default admin tab
  showAdminTab('about-tab');
}
window.showAdminPanelAfterLogin = showAdminPanelAfterLogin;

/* perform logout UI update (called after firebase signOut complete) */
function performLogoutUI() {
  const adminPanel = document.getElementById('admin-panel');
  const loginBox = document.getElementById('admin-login');
  if (adminPanel) { 
    adminPanel.classList.add('hidden'); 
    adminPanel.style.display = 'none'; 
  }
  if (loginBox) { 
    loginBox.classList.add('hidden');
    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙØ±Ù… Ù„Ø§Ú¯ÛŒÙ†
    document.getElementById('adminUser').value = '';
    document.getElementById('adminPass').value = '';
  }
  document.querySelectorAll('#admin-logout-btn').forEach(b => b.classList.add('hidden'));
  // Ù†Ù…Ø§ÛŒØ´ Ø¨Ø®Ø´ Ø¹Ù…ÙˆÙ…ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ù†
  showSection('about');
}
window.performLogoutUI = performLogoutUI;

/* ---------- Firebase-driven wrappers (call storageBridge) ---------- */

/* load About from bridge and run typing */
function loadAbout() {
  try {
    window.storageBridge?.loadAbout?.().then(about => {
      if (about && (about.en || about.fa)) {
        const text = about.en || about.fa || "";
        const aboutEl = document.getElementById('about-en');
        if (aboutEl) {
          aboutEl.innerHTML = ''; // Clear previous content
          typeText(aboutEl, text, 35);
        }
      }
    });
  } catch (e) {
    console.warn('loadAbout failed', e);
  }
}

window.loadAbout = loadAbout;

// ØªØ§Ø¨Ø¹ showSection Ø¯Ø± Ø¨Ø§Ù„Ø§ÛŒ ÙØ§ÛŒÙ„ ØªØ¹Ø±ÛŒÙ Ø´Ø¯Ù‡ Ø§Ø³Øª

/* saveAbout (called from admin textarea) */
async function saveAbout(text) {
  if (!text || !text.trim()) { showNotification('Please enter about text.', 'warning'); return; }
  const payload = { en: text.trim(), updated: new Date().toISOString() };
  try {
    await window.storageBridge.saveAbout(payload);
  showNotification('âœ… About saved.', 'success');
    await loadAbout();
  } catch (e) {
    console.error(e);
  showNotification('âŒ Saving about failed.', 'error');
  }
}
window.saveAbout = saveAbout;

/* ==== About Editor Formatting ==== */
function formatText(command) {
  document.execCommand(command, false, null);
}

function addLink() {
  const url = prompt("Enter URL:");
  if (url) document.execCommand("createLink", false, url);
}

async function clearAboutText() {
  if (!confirm("Are you sure you want to clear the About content? This will delete it from both the editor and Firebase.")) {
    return;
  }

  const editor = document.getElementById("about-editor");
  if (editor) {
    editor.innerHTML = "";
  }

  try {
    await window.storageBridge.saveAbout({ en: "", updated: new Date().toISOString() });
    const aboutEl = document.getElementById("about-en");
    if (aboutEl) {
      aboutEl.innerHTML = "";
    }
    showNotification("âœ… About content cleared successfully!", 'success');
  } catch (e) {
    console.error("Clear about failed:", e);
    showNotification("âŒ Could not clear about section.", 'error');
  }
}

/* ==== Save About using contenteditable area ==== */
async function saveAboutFromEditor() {
  const editor = document.getElementById("about-editor");
  if (!editor) { showNotification("Editor not found.", 'error'); return; }
  const html = editor.innerHTML.trim();
  if (!html) { showNotification("Please write something first.", 'warning'); return; }

  const aboutData = { 
    en: html, 
    updated: new Date().toISOString() 
  };

  try {
    // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ§ÛŒØ±Ø¨ÛŒØ³
    await window.storageBridge.saveAbout(aboutData);

    // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø§Ø¯ÛŒØªÙˆØ±
    editor.innerHTML = "";

    // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù„ÛŒØ³Øª Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ
    await loadSavedAbouts();
    await loadAbout();

    showNotification("âœ… Ù…ØªÙ† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯!", 'success');
  } catch (e) {
    console.error("Save about failed:", e);
    showNotification("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ Ù…ØªÙ†", 'error');
  }
}


/* ==== Load About Content ==== */
async function loadAboutEditor() {
  try {
    const aboutData = await window.storageBridge.loadAbout();
    const editor = document.getElementById("about-editor");
    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø± Ø§Ø¯ÛŒØªÙˆØ± (Ù†Ù…Ø§ÛŒØ´ Ù…ØªÙ† Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´)
    if (editor) {
      editor.innerHTML = aboutData?.en || "";
    }
  } catch (e) {
    console.warn("âš ï¸ loadAboutEditor failed:", e);
  }
}

/* ==== Load saved abouts (list + main) and render admin list ==== */
async function loadSavedAbouts() {
  try {
    const listNode = document.getElementById('about-items-list');
    if (listNode) listNode.innerHTML = '';

    // load main about (single)
    const main = await window.storageBridge.loadAbout();

    // load saved list
    const arr = await (window.storageBridge.loadAboutList ? window.storageBridge.loadAboutList() : Promise.resolve([]));
    const items = Array.isArray(arr) ? arr : [];
    if (!listNode) return;

    // render main as first item (editable/deleteable as special 'main' item)
    if (main?.en) {
      const div = document.createElement('div');
      div.className = 'about-item';
      div.innerHTML = `
        <div class="about-item-content">${main.en}</div>
        <div class="about-item-actions">
          <button class="edit-about-btn" data-id="__main">âœï¸ Edit</button>
          <button class="delete-about-btn" data-id="__main">ğŸ—‘ï¸ Delete</button>
        </div>
      `;
      listNode.appendChild(div);
    }

    // render each saved item
    items.forEach(it => {
      const id = it.id || '';
      const div = document.createElement('div');
      div.className = 'about-item';
      div.innerHTML = `
        <div class="about-item-content">${it.en}</div>
        <div class="about-item-actions">
          <button class="edit-about-btn" data-id="${id}">âœï¸ Edit</button>
          <button class="delete-about-btn" data-id="${id}">ğŸ—‘ï¸ Delete</button>
        </div>
        <div class="about-item-date">${it.updated ? new Date(it.updated).toLocaleString() : ''}</div>
      `;
      listNode.appendChild(div);
    });

    // attach handlers
    listNode.querySelectorAll('.edit-about-btn').forEach(btn => {
      btn.onclick = async (e) => {
        const id = btn.getAttribute('data-id');
        const editor = document.getElementById('about-editor');
        if (!editor) return;
        if (id === '__main') {
          const mainData = await window.storageBridge.loadAbout();
          editor.innerHTML = mainData?.en || '';
        } else {
          const list = await window.storageBridge.loadAboutList();
          const found = (list || []).find(x => x.id === id);
          editor.innerHTML = found?.en || '';
        }
        editor.focus();
      };
    });

    listNode.querySelectorAll('.delete-about-btn').forEach(btn => {
      btn.onclick = async (e) => {
        const id = btn.getAttribute('data-id');
        if (!confirm('Are you sure you want to delete this about text?')) return;
        if (id === '__main') {
          await window.storageBridge.saveAbout({ en: '', updated: new Date().toISOString() });
        } else {
          await window.storageBridge.deleteAbout(id);
        }
        await loadSavedAbouts();
        await loadAbout();
      };
    });

  } catch (e) {
    console.warn('loadSavedAbouts failed', e);
  }
}

// Load content when admin tabs are shown
window.showAdminTab = function(id) {
  document.querySelectorAll('.admin-tab').forEach(tab => {
    tab.classList.add('hidden');
    tab.style.display = 'none';
  });
  const t = document.getElementById(id);
  if (t) {
    t.classList.remove('hidden');
    t.style.display = 'block';
    
    // Load content based on tab
    if (id === 'about-tab') {
      loadAboutEditor();
      loadSavedAbouts();
    } else if (id === 'blog-tab') {
      loadBlogsFromStorage(); // Load blogs when blog tab is opened
    }
  }
}

/* Blogs: add, load admin list, load public */
async function addBlog() {
  const title = (document.getElementById('blog-title')?.value || '').trim();
  const bodyHtml = document.getElementById('blog-body-editor')?.innerHTML?.trim() || '';
  const category = (document.getElementById('blog-category')?.value) || 'general';

  if (!title || !bodyHtml) { showNotification('Please enter title and body.', 'warning'); return; }

  const blog = { title: { en: title }, body: { en: bodyHtml }, category, date: new Date().toISOString() };
  try {
    // support simple edit-mode: if admin set data-edit-idx on the add button, remove the old entry then add new
    const addBtn = document.getElementById('blog-add-btn');
    const editIdx = addBtn?.getAttribute('data-edit-idx');
    if (editIdx !== null && editIdx !== undefined && editIdx !== '') {
      const blogs = await window.storageBridge.loadBlogs();
      const idx = parseInt(editIdx);
      const toDeleteId = (Array.isArray(blogs) && blogs[idx]) ? blogs[idx].id : null;
      if (toDeleteId) await window.storageBridge.deleteBlog(toDeleteId, idx);
      addBtn.removeAttribute('data-edit-idx');
      addBtn.textContent = 'Add Blog';
    }

    await window.storageBridge.saveBlog(blog);
    showNotification('âœ… Blog saved.', 'success');
    document.getElementById('blog-title').value = '';
    document.getElementById('blog-body-editor').innerHTML = '';
    await loadBlogsFromStorage();
    await loadPublicBlogs(true);
  } catch (e) {
    console.error(e);
    showNotification('âŒ Save blog failed.', 'error');
  }
}
window.addBlog = addBlog;

async function loadBlogsFromStorage() {
  const node = document.getElementById('blog-items-list');
  if (!node) return;
  node.innerHTML = '';
  try {
    const blogs = await window.storageBridge.loadBlogs();
    if (!Array.isArray(blogs)) return;
    blogs.forEach((b, idx) => {
      const title = (b.title && (b.title.en || b.title.fa)) || (typeof b.title === 'string' ? b.title : 'Untitled');
      const body = (b.body && (b.body.en || b.body.fa)) || (typeof b.body === 'string' ? b.body : '');
      const date = b.date ? new Date(b.date).toLocaleString() : '';
      
      const div = document.createElement('div');
      div.className = 'blog-item';
      div.innerHTML = `
        <div class="blog-item-header">
          <h3>${title}</h3>
          <span class="blog-item-category">${b.category || 'General'}</span>
        </div>
        <div class="blog-item-content">${body}</div>
        <div class="blog-item-actions">
          <button class="edit-blog-btn" data-idx="${idx}">âœï¸ Edit</button>
          <button class="delete-blog-btn" data-id="${b.id || ''}" data-idx="${idx}">ğŸ—‘ï¸ Delete</button>
        </div>
        <div class="blog-item-date">${date}</div>
      `;
      node.appendChild(div);
    });

    // attach delete handlers
    node.querySelectorAll('.delete-blog-btn').forEach(btn => {
      btn.onclick = async (e) => {
        const id = btn.getAttribute('data-id');
        const idx = parseInt(btn.getAttribute('data-idx'));
        if (!confirm('Are you sure you want to delete this blog post?')) return;
        await window.storageBridge.deleteBlog(id || null, idx);
        await loadBlogsFromStorage();
        await loadPublicBlogs(true);
      };
    });

    // attach edit handlers
    node.querySelectorAll('.edit-blog-btn').forEach(btn => {
      btn.onclick = async (e) => {
        const idx = parseInt(btn.getAttribute('data-idx'));
        const blogs = await window.storageBridge.loadBlogs();
        const b = (blogs || [])[idx];
        if (!b) return;
        document.getElementById('blog-title').value = (b.title && b.title.en) || '';
        document.getElementById('blog-body-editor').innerHTML = (b.body && b.body.en) || '';
        const addBtn = document.getElementById('blog-add-btn');
        if (addBtn) { addBtn.textContent = 'Update Blog'; addBtn.setAttribute('data-edit-idx', idx); }
      };
    });
  } catch (e) {
    console.warn('loadBlogsFromStorage failed', e);
  }
}
window.loadBlogsFromStorage = loadBlogsFromStorage;

let _blogsLoadedOnce = false;
async function loadPublicBlogs(force = false) {
  const node = document.getElementById('public-blog-list');
  if (!node) return;
  if (_blogsLoadedOnce && !force) return;
  node.innerHTML = '';
  try {
    const blogs = await window.storageBridge.loadBlogs();
    if (!Array.isArray(blogs) || blogs.length === 0) {
      node.innerHTML = '<p>Ù‡Ù†ÙˆØ² Ù…Ø·Ù„Ø¨ÛŒ Ù…Ù†ØªØ´Ø± Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>';
      return;
    }
    blogs.forEach(b => {
      const title = (b.title && (b.title.en || b.title.fa)) || (typeof b.title === 'string' ? b.title : 'Untitled');
      const body = (b.body && (b.body.en || b.body.fa)) || (typeof b.body === 'string' ? b.body : '');
      const article = document.createElement('article');
      article.setAttribute('data-category', b.category || '');
      // create a plain-text snippet of the HTML body
      const tmp = document.createElement('div');
      tmp.innerHTML = body;
      const plain = (tmp.textContent || tmp.innerText || '').trim();
      const snippet = plain.length > 250 ? plain.slice(0,250) + '...' : plain;
      article.innerHTML = `
        <h3>${title}</h3>
        <div class="blog-snippet">${snippet}</div>
        <div class="blog-full-content hidden"></div>
        <button class="read-more-btn">Continue reading</button>
      `;

      const readBtn = article.querySelector('.read-more-btn');
      const snippetNode = article.querySelector('.blog-snippet');
      const fullNode = article.querySelector('.blog-full-content');

      readBtn.onclick = () => {
        // Toggle inline full content
        if (fullNode.classList.contains('hidden')) {
          fullNode.innerHTML = body || '';
          fullNode.classList.remove('hidden');
          snippetNode.classList.add('hidden');
          readBtn.textContent = 'Show less';
        } else {
          fullNode.innerHTML = '';
          fullNode.classList.add('hidden');
          snippetNode.classList.remove('hidden');
          readBtn.textContent = 'Continue reading';
        }
      };
      node.appendChild(article);
    });
    _blogsLoadedOnce = true;
  } catch (e) {
    console.warn('loadPublicBlogs failed', e);
  }
}
window.loadPublicBlogs = loadPublicBlogs;


/* --- Handle Project Files Upload --- */
let uploadedFiles = [];
async function handleProjectFiles(event) {
  const fileList = event.target.files;
  const filesListDiv = document.getElementById('uploaded-files-list');
  if (filesListDiv) filesListDiv.innerHTML = '';
  uploadedFiles = [];

  for (const file of Array.from(fileList)) {
    const base64 = await new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => resolve(e.target.result);
      reader.onerror = (err) => reject(err);
      reader.readAsDataURL(file);
    });

    uploadedFiles.push({
      name: file.name,
      type: file.type,
      size: file.size,
      data: base64
    });

    if (filesListDiv) {
      const fileDiv = document.createElement('div');
      fileDiv.className = 'uploaded-file-item';
      fileDiv.innerHTML = `<span class="file-name">ğŸ“„ ${file.name}</span>
                           <span class="file-size">(${(file.size/1024).toFixed(1)} KB)</span>`;
      filesListDiv.appendChild(fileDiv);
    }
  }
}
window.handleProjectFiles = handleProjectFiles;

/* --- addPortfolio: add or update item, save via storageBridge --- */
async function addPortfolio() {
  const title = (document.getElementById('portfolio-title')?.value || '').trim();
  const link = (document.getElementById('portfolio-link')?.value || '').trim();
  const imageInput = document.getElementById('portfolio-image-file');
  const imageUrlInput = (document.getElementById('portfolio-image')?.value || '').trim();
  const saveBtn = document.getElementById('portfolio-save-btn');

  let finalImage = imageUrlInput;

  // if user selected an image file, convert to base64 and use it
  if (imageInput && imageInput.files && imageInput.files.length > 0) {
    const file = imageInput.files[0];
    finalImage = await new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = (e) => resolve(e.target.result);
      reader.onerror = (err) => reject(err);
      reader.readAsDataURL(file);
    });
  }

  if (!title || !finalImage) {
    showNotification('âŒ Please provide at least a title and an image.', 'warning');
    return;
  }

  // load existing items
  const allItems = await (window.storageBridge?.loadPortfolio?.() || []);
  const newItem = {
    title,
    link: link || '',
    image: finalImage,
    date: new Date().toISOString(),
    files: Array.isArray(uploadedFiles) ? uploadedFiles.slice() : []
  };

  // edit mode?
  const editIndexAttr = saveBtn?.getAttribute('data-edit-index');
  if (editIndexAttr !== null && editIndexAttr !== '') {
    const idx = parseInt(editIndexAttr);
    allItems[idx] = newItem;
    if (saveBtn) { saveBtn.removeAttribute('data-edit-index'); saveBtn.textContent = 'ğŸ’¾ Save Portfolio'; }
    await window.storageBridge.savePortfolio(allItems);
    showNotification('âœ… Portfolio item updated.', 'success');
  } else {
    allItems.push(newItem);
    await window.storageBridge.savePortfolio(allItems);
    showNotification('âœ… Portfolio item saved.', 'success');
  }

  // reset form
  document.getElementById('portfolio-title').value = '';
  document.getElementById('portfolio-link').value = '';
  document.getElementById('portfolio-image').value = '';
  if (document.getElementById('portfolio-image-file')) document.getElementById('portfolio-image-file').value = '';
  if (document.getElementById('portfolio-preview')) document.getElementById('portfolio-preview').classList.add('hidden');
  uploadedFiles = [];

  await loadPortfolio();
  await loadPortfolioAdmin();
}
window.addPortfolio = addPortfolio;

/* --- Delete item --- */
async function deletePortfolio(index) {
  try {
    if (!confirm('ğŸ—‘ï¸ Are you sure you want to delete this project? This action cannot be undone.')) return;
    
    showNotification('ğŸ—‘ï¸ Deleting project...', 'info');
    
    // Load current items
    const items = await (window.storageBridge?.loadPortfolio?.() || []);
    const itemToDelete = items[index];
    
    if (!itemToDelete) {
      showNotification('âŒ Project not found!', 'error');
      return;
    }

    // Remove from array
    items.splice(index, 1);

    // Save updated list to Firebase
    await window.storageBridge.savePortfolio(items);

    // Refresh both public and admin views
    await loadPortfolio();
    await loadPortfolioAdmin();
    
    showNotification('âœ… Project deleted successfully!', 'success');
  } catch (error) {
    console.error('Delete portfolio error:', error);
    showNotification('âŒ Error deleting project: ' + error.message, 'error');
  }
}

/* --- editPortfolio (populate form for editing) --- */
async function editPortfolio(index) {
  const items = await (window.storageBridge?.loadPortfolio?.() || []);
  const it = items[index];
  if (!it) return;
  document.getElementById('portfolio-title').value = it.title || '';
  document.getElementById('portfolio-link').value = it.link || '';
  document.getElementById('portfolio-image').value = it.image || '';
  const preview = document.getElementById('portfolio-preview');
  if (preview) { preview.src = it.image || ''; preview.classList.remove('hidden'); }
  // set uploadedFiles to existing files for potential update
  uploadedFiles = Array.isArray(it.files) ? it.files.slice() : [];
  const saveBtn = document.getElementById('portfolio-save-btn');
  if (saveBtn) { saveBtn.textContent = 'ğŸ’¾ Update Portfolio'; saveBtn.setAttribute('data-edit-index', index); }
}
window.editPortfolio = editPortfolio;

/* --- loadPortfolio: render public gallery and attach open handlers --- */
async function loadPortfolio() {
  const galleryTrack = document.querySelector('.gallery-track');
  if (!galleryTrack) return;
  galleryTrack.innerHTML = '';

  const items = await (window.storageBridge?.loadPortfolio?.() || []);
  if (!Array.isArray(items)) return;

  items.forEach((item, idx) => {
    if (!item) return;
    const wrapper = document.createElement('div');
    wrapper.className = 'portfolio-card';

    const img = document.createElement('img');
    img.src = item.image || '';
    img.alt = item.title || '';
    img.loading = 'lazy';
    img.className = 'portfolio-thumb';

    // clickable area: use a button/anchor that calls openPortfolio
    const btn = document.createElement('a');
    btn.href = 'javascript:void(0)';
    btn.className = 'portfolio-link';
    btn.setAttribute('data-idx', idx);
    btn.onclick = (e) => { e.preventDefault(); openPortfolio(idx); };

    btn.appendChild(img);

    // optional caption overlay
    const cap = document.createElement('div');
    cap.className = 'portfolio-caption';
    cap.textContent = item.title || '';
    wrapper.appendChild(btn);
    wrapper.appendChild(cap);

    galleryTrack.appendChild(wrapper);
  });

  // if you use sliding transform logic elsewhere, ensure galleryTrack children styled accordingly
}
window.loadPortfolio = loadPortfolio;

/* --- openPortfolio: open link or file (index) for given index --- */
async function openPortfolio(index) {
  const items = await (window.storageBridge?.loadPortfolio?.() || []);
  const item = items[index];
  if (!item) return;

  // 1) if item.link exists -> open directly
  if (item.link && item.link.trim()) {
    const url = item.link;
    window.open(url, '_blank');
    return;
  }

  // 2) if files exist try to find index.html (or any .html) and open as blob URL
  if (Array.isArray(item.files) && item.files.length > 0) {
    // prefer index.html
    let file = item.files.find(f => /index\.html$/i.test(f.name));
    if (!file) file = item.files.find(f => /\.html$/i.test(f.name));
    if (file && file.data) {
      try {
        // file.data is base64/dataURL string -> fetch it then create blob URL
        const res = await fetch(file.data);
        const blob = await res.blob();
        const blobUrl = URL.createObjectURL(blob);
        window.open(blobUrl, '_blank');
        return;
      } catch (err) {
        console.error('openPortfolio blob error', err);
        showNotification('âŒ Could not open project file.', 'error');
      }
    }
  }

  // 3) nothing to open
  showNotification('âš ï¸ No link or uploaded project file found for this item.', 'warning');
}
window.openPortfolio = openPortfolio;


/* --- previewPortfolioImage: preview single image file chosen --- */
function previewPortfolioImage(event) {
  const file = event.target.files && event.target.files[0];
  const preview = document.getElementById('portfolio-preview');
  if (file) {
    const reader = new FileReader();
    reader.onload = (e) => {
      if (preview) { preview.src = e.target.result; preview.classList.remove('hidden'); }
    };
    reader.readAsDataURL(file);
  } else {
    if (preview) { preview.src = ''; preview.classList.add('hidden'); }
  }
}
window.previewPortfolioImage = previewPortfolioImage;



/* --- loadPortfolioAdmin: render admin list with edit/delete --- */
async function loadPortfolioAdmin() {
  const list = document.getElementById('portfolio-list');
  if (!list) return;
  list.innerHTML = '';

  const items = await (window.storageBridge?.loadPortfolio?.() || []);
  if (!Array.isArray(items)) return;

  items.forEach((item, index) => {
    const div = document.createElement('div');
    div.className = 'portfolio-admin-item';
    div.innerHTML = `
      <div class="portfolio-header">
        <h3 class="portfolio-title">${item.title || ''}</h3>
        <div class="portfolio-actions">
          <button class="edit-btn" data-idx="${index}">âœï¸ Edit</button>
          <button class="delete-btn" data-idx="${index}">ğŸ—‘ï¸ Delete</button>
        </div>
      </div>
      <div class="portfolio-content">
        <div class="portfolio-image"><img src="${item.image || ''}" alt="${item.title || ''}" /></div>
        <div class="portfolio-details">
          ${item.link ? `<div class="portfolio-link"><a href="${item.link}" target="_blank">ğŸ”— View Project</a></div>` : ''}
          ${item.files && item.files.length ? `<div class="portfolio-files"><h4>ğŸ“ Files:</h4>
            ${item.files.map(f => `<div class="file-item">ğŸ“„ ${f.name} (${(f.size/1024).toFixed(1)} KB)</div>`).join('')}</div>` : ''}
        </div>
      </div>
    `;
    list.appendChild(div);

    // attach handlers
    div.querySelector('.edit-btn').onclick = () => editPortfolio(index);
    div.querySelector('.delete-btn').onclick = async () => {
      if (!confirm('ğŸ—‘ï¸ Delete this project?')) return;
      const arr = await (window.storageBridge?.loadPortfolio?.() || []);
      arr.splice(index,1);
      await window.storageBridge.savePortfolio(arr);
      await loadPortfolioAdmin();
      await loadPortfolio();
      showNotification('âœ… Deleted', 'success');
    };
  });
}
window.loadPortfolioAdmin = loadPortfolioAdmin;

/* Contact save/load */
async function saveContactInfo() {
  const phone = (document.getElementById('admin-phone')?.value || '').trim();
  const email = (document.getElementById('admin-email')?.value || '').trim();
  const social = (document.getElementById('admin-social')?.value || '').trim();
  if (!phone || !email) { showNotification('Please fill phone and email.', 'warning'); return; }
  try {
    await window.storageBridge.saveContact({ phone, email, social });
    showNotification('âœ… Contact saved.', 'success');
  } catch (e) {
    console.warn(e);
    showNotification('âŒ Save contact failed.', 'error');
  }
}
window.saveContactInfo = saveContactInfo;

async function loadContactInfo() {
  try {
    const c = await window.storageBridge.loadContact();
    if (!c) return;
    document.getElementById('admin-phone') && (document.getElementById('admin-phone').value = c.phone || '');
    document.getElementById('admin-email') && (document.getElementById('admin-email').value = c.email || '');
    document.getElementById('admin-social') && (document.getElementById('admin-social').value = c.social || '');
  } catch (e) { console.warn('loadContactInfo failed', e); }
}
window.loadContactInfo = loadContactInfo;

/* small UI helpers */
function scrollGallery(dir=1) {
  const track = document.querySelector('.gallery-track');
  if (!track) return;
  const amount = 300;
  track.scrollBy({ left: dir * amount, behavior: 'smooth' });
}
window.scrollGallery = scrollGallery;

/* DOM ready: attach single submit handler (will call firebase login if available) */
window.addEventListener('DOMContentLoaded', () => {
  // ensure menu visible
  const menu = document.querySelector('.menu');
  if (menu) menu.style.display = "";

  // attach login form safely (if bridge later replaces it, bridge will reattach)
  const form = document.getElementById('admin-form');
  if (form && !form.__attached) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      // prefer firebase login provided by bridge
      if (typeof window.loginAdminFirebase === 'function') {
        try {
          await window.loginAdminFirebase(e);
        } catch (err) {
          console.warn('Firebase login failed', err);
          return; // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø¯Ø§Ù…Ù‡ Ú©Ø¯ Ø¯Ø± ØµÙˆØ±Øª Ø®Ø·Ø§
        }
      } else {
        showNotification('âš ï¸ Auth not ready. Please wait a moment and try again.', 'warning');
      }
    });
    form.__attached = true;
  }

  // attach logout btn(s) to call performLogout (bridge provides it)
  document.querySelectorAll('#admin-logout-btn').forEach(btn => {
    if (!btn.__attached) {
      btn.addEventListener('click', async (e) => {
        e.preventDefault();
        if (typeof window.performLogout === 'function') {
          try { await window.performLogout(); } catch (err) { console.warn(err); window.performLogoutUI(); }
        } else {
          window.performLogoutUI();
        }
      });
      btn.__attached = true;
    }
  });

  // logo click: toggle admin login (ensure still works after any replacements)
  const logo = document.querySelector('.logo-title');
  if (logo) {
    logo.onclick = () => {
      const box = document.getElementById('admin-login');
      if (box) box.classList.toggle('hidden');
    };
  }

  // show default public section
  showSection('about');
  loadAbout();
});

/* --- Simple rich text editor commands --- */
function execCmd(command, value = null) {
  document.execCommand(command, false, value);
}

/* ==== Portfolio slideshow logic ==== */
let currentPortfolioIndex = 0;

function scrollGallery(direction) {
  const track = document.querySelector('.gallery-track');
  const items = document.querySelectorAll('.gallery-track a');
  if (!track || items.length === 0) return;

  currentPortfolioIndex += direction;
  if (currentPortfolioIndex < 0) currentPortfolioIndex = items.length - 1;
  if (currentPortfolioIndex >= items.length) currentPortfolioIndex = 0;

  track.style.transform = `translateX(-${currentPortfolioIndex * 100}%)`;
}

// auto slide every 6s
setInterval(() => {
  const portfolioSection = document.getElementById('portfolio');
  if (portfolioSection && !portfolioSection.classList.contains('hidden')) {
    scrollGallery(1);
  }
}, 6000);


</script>

<script type="module">
/* ===== Firebase Bridge: Auth + Realtime DB + storageBridge ===== */
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-app.js";
import { getDatabase, ref, push, get, remove, set } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-database.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.8.0/firebase-auth.js";

/* --- Firebase config --- */
const firebaseConfig = {
  apiKey: "AIzaSyB-_AtMVlICupwsLg-dAjfoO6cH-ItE5ls",
  authDomain: "iliya-official.firebaseapp.com",
  databaseURL: "https://iliya-official-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "iliya-official",
  storageBucket: "iliya-official.firebasestorage.app",
  messagingSenderId: "525136175554",
  appId: "1:525136175554:web:d3ef4c5cf938789bde765b"
};

/* --- Initialize Firebase --- */
let app, db, auth;
try {
  app = initializeApp(firebaseConfig);
  db = getDatabase(app);
  auth = getAuth(app);
  console.info("âœ… Firebase initialized");
} catch (e) {
  console.error("âŒ Firebase init failed", e);
}

/* ---------- storageBridge implementation ---------- */
window.storageBridge = {
  /* ===== ABOUT ===== */
  async saveAbout(data) {
    if (db) {
      await set(ref(db, "about/main"), data);
      return true;
    }
    localStorage.setItem("aboutSection", JSON.stringify(data));
    return false;
  },
  async loadAbout() {
    if (db) {
      const snap = await get(ref(db, "about/main"));
      return snap.exists() ? snap.val() : null;
    }
    try { return JSON.parse(localStorage.getItem("aboutSection") || "null"); } catch(e){ return null; }
  },
  
  // New functions for managing multiple about texts
  async saveAboutList(data) {
    if (db) {
      const listRef = ref(db, "about/texts");
      const newItemRef = push(listRef);
      await set(newItemRef, { ...data, id: newItemRef.key });
      return true;
    }
    const list = JSON.parse(localStorage.getItem("aboutTexts") || "[]");
    list.push(data);
    localStorage.setItem("aboutTexts", JSON.stringify(list));
    return false;
  },
  
  async loadAboutList() {
    if (db) {
      const snap = await get(ref(db, "about/texts"));
      if (!snap.exists()) return [];
      const data = snap.val();
      return Object.keys(data).map(key => ({
        ...data[key],
        id: key
      }));
    }
    try { return JSON.parse(localStorage.getItem("aboutTexts") || "[]"); } catch(e){ return []; }
  },
  
  async deleteAbout(id) {
    if (db) {
      await remove(ref(db, `about/texts/${id}`));
      return true;
    }
    let list = JSON.parse(localStorage.getItem("aboutTexts") || "[]");
    list = list.filter(item => item.id !== id);
    localStorage.setItem("aboutTexts", JSON.stringify(list));
    return false;
  },

  /* ===== BLOGS ===== */
  async saveBlog(blog) {
    if (db) {
      const r = await push(ref(db, "blogs"), blog);
      return { id: r.key };
    }
    const arr = JSON.parse(localStorage.getItem("blogs") || "[]");
    arr.push(blog);
    localStorage.setItem("blogs", JSON.stringify(arr));
    return null;
  },
  async loadBlogs() {
    if (db) {
      const snap = await get(ref(db, "blogs"));
      if (!snap.exists()) return [];
      const val = snap.val();
      return Object.keys(val).map(k => ({ id: k, ...val[k] }));
    }
    return JSON.parse(localStorage.getItem("blogs") || "[]");
  },
  async deleteBlog(id, idx) {
    if (db && id) {
      await remove(ref(db, `blogs/${id}`));
      return true;
    }
    const arr = JSON.parse(localStorage.getItem("blogs") || "[]");
    if (typeof idx === "number") arr.splice(idx, 1);
    localStorage.setItem("blogs", JSON.stringify(arr));
    return false;
  },

  /* ===== PORTFOLIO ===== */
  async savePortfolio(data) {
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¨Ø±Ø§ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨Ø²Ø±Ú¯
    try {
      // Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø§ÛŒØ² Ú©Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
      let totalSize = 0;
      data.forEach(item => {
        if (item.files) {
          item.files.forEach(file => {
            totalSize += file.data.length;
          });
        }
      });

      // Ù‡Ø´Ø¯Ø§Ø± Ø§Ú¯Ø± Ø­Ø¬Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø®ÛŒÙ„ÛŒ Ø²ÛŒØ§Ø¯ Ø§Ø³Øª
      if (totalSize > 10 * 1024 * 1024) { // 10MB
        showNotification('âš ï¸ Total files size is too large. Consider uploading smaller files.', 'warning');
      }

      if (db) {
        await set(ref(db, "portfolio/main"), data);
        showNotification('âœ… Portfolio saved successfully!', 'success');
        return true;
      }
      localStorage.setItem("portfolio", JSON.stringify(data));
      return false;
    } catch (error) {
      console.error('Portfolio save error:', error);
      showNotification('âŒ Error saving portfolio: ' + error.message, 'error');
      throw error;
    }
  },
  
  async loadPortfolio() {
    try {
      if (db) {
        const snap = await get(ref(db, "portfolio/main"));
        return snap.exists() ? snap.val() : [];
      }
      try { return JSON.parse(localStorage.getItem("portfolio") || "[]"); }
      catch(e){ return []; }
    } catch (error) {
      console.error('Portfolio load error:', error);
      showNotification('âŒ Error loading portfolio: ' + error.message, 'error');
      return [];
    }
  },
  async deletePortfolio(id, idx) {
    if (db && id) {
      await remove(ref(db, `portfolio/${id}`));
      return true;
    }
    const arr = JSON.parse(localStorage.getItem("portfolio") || "[]");
    if (typeof idx === "number") arr.splice(idx, 1);
    localStorage.setItem("portfolio", JSON.stringify(arr));
    return false;
  },

  /* ===== CONTACT ===== */
  async saveContact(data) {
    if (db) {
      await set(ref(db, "contact/info"), data);
      return true;
    }
    localStorage.setItem("contactInfo", JSON.stringify(data));
    return false;
  },
  async loadContact() {
    if (db) {
      const snap = await get(ref(db, "contact/info"));
      return snap.exists() ? snap.val() : {};
    }
    try { return JSON.parse(localStorage.getItem("contactInfo") || "{}"); }
    catch(e){ return {}; }
  }
};

/* ---------- Auth functions ---------- */
if (auth) {
  window.loginAdminFirebase = async function(event) {
    if (event && event.preventDefault) event.preventDefault();
    const userInput = (document.getElementById("adminUser")?.value || "").trim();
    const pass = (document.getElementById("adminPass")?.value || "").trim();
    if (!userInput || !pass) {
      showNotification("âš ï¸ Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯", 'warning');
      throw new Error("Missing credentials");
    }

    const email = userInput.includes("@") ? userInput : "alirezamotieerad@gmail.com";

    try {
      const cred = await signInWithEmailAndPassword(auth, email, pass);
      if (cred?.user) {
        window.showAdminPanelAfterLogin && window.showAdminPanelAfterLogin();
        return cred;
      } else {
        showNotification("âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯", 'error');
        throw new Error("Login failed - no user");
      }
    } catch (err) {
      console.error("Firebase login error", err);
      if (err.code === "auth/invalid-credential" || err.code === "auth/wrong-password") {
        showNotification("âŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª", 'error');
      } else {
        showNotification("âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: " + err.message, 'error');
      }
      throw err;
    }
  };

  window.performLogout = async function() {
    try {
      await signOut(auth);
    } catch (e) {
      console.warn("signOut failed", e);
    }
    // Update UI silently (no alerts/confirm)
    window.performLogoutUI && window.performLogoutUI();
  };

  onAuthStateChanged(auth, (user) => {
    if (user) {
      console.info("ğŸ‘‘ Admin active:", user.email);
      window._isAdminLoggedIn = true;
    } else {
      console.info("ğŸ‘¤ Not logged in");
      window._isAdminLoggedIn = false;
      window.performLogoutUI && window.performLogoutUI();
    }
  });
} else {
  window.loginAdminFirebase = async function() { throw new Error("Auth not initialized"); };
  window.performLogout = async function() { window.performLogoutUI && window.performLogoutUI(); };
}

console.info("âœ… Firebase bridge ready (about + blog + portfolio + contact)");
// After bridge is ready, trigger initial loads that depend on storageBridge
try {
  if (typeof window.loadAbout === 'function') {
    window.loadAbout();
  }
  if (typeof window.loadPublicBlogs === 'function') {
    window.loadPublicBlogs(true);
  }
} catch (e) {
  console.warn('Post-bridge initial load failed', e);
}
</script>
<!-- End Firebase Script -->

</body>
</html>